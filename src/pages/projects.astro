---
import Layout from "../components/Layout.astro";
const { base = "" } = Astro.site
  ? { base: import.meta.env.BASE_URL }
  : { base: "" };

const mdPostsGlob = import.meta.glob("../content/projects/*.md", {
  eager: true,
});
const mdxPostsGlob = import.meta.glob("../content/projects/*.mdx", {
  eager: true,
});

const allPosts = [
  ...Object.values(mdPostsGlob),
  ...Object.values(mdxPostsGlob),
] as any[];
const sortedPosts = allPosts.sort(
  (a: any, b: any) =>
    new Date(b.frontmatter.date).getTime() -
    new Date(a.frontmatter.date).getTime(),
);
---

<Layout
  title="Projects"
  description="Projects by Alex Marcus"
  showSidebar={false}
>
  <div class="project-page">
    <header class="project-header">
      <h1 class="project-title">Projects</h1>
      <p class="project-description">A collection of my favorite projects.</p>
      <hr />
    </header>

    {
      sortedPosts.length > 0 ? (
        <div class="posts-list">
          {sortedPosts.map((post: any) => (
            <a
              href={`${base}projects/${post.file
                .split("/")
                .pop()
                ?.replace(/\.(md|mdx)$/, "")}`}
              class="post-item"
              style="display: block; text-decoration: none;"
            >
              <article style="pointer-events: none;">
                <h2 class="post-title" style="pointer-events: auto;">
                  {post.frontmatter.title}
                </h2>

                <div class="post-meta">
                  <time class="post-date" datetime={post.frontmatter.date}>
                    {new Date(post.frontmatter.date).toLocaleDateString(
                      "en-US",
                      {
                        year: "numeric",
                        month: "long",
                      },
                    )}
                  </time>

                  {post.frontmatter.tags && (
                    <div class="post-tags">
                      {post.frontmatter.tags.map((tag: string) => (
                        <span class="tag">{tag}</span>
                      ))}
                    </div>
                  )}
                </div>
                {post.frontmatter.description && (
                  <p>{post.frontmatter.description}</p>
                )}
              </article>
            </a>
          ))}
        </div>
      ) : (
        <div class="no-posts">
          <p>
            No posts available yet. Start writing by creating files in{" "}
            <code>src/pages/projects/</code>
          </p>
        </div>
      )
    }
  </div>
</Layout>

<style>
  .project-page {
    max-width: 800px;
    margin: 0 auto;
  }

  .project-header {
    text-align: center;
    margin-bottom: calc(var(--grid-unit) * 8);
  }

  .posts-list {
    display: flex;
    flex-direction: column;
    gap: calc(var(--grid-unit) * 6);
  }

  .post-item {
    border-bottom: 1px solid var(--color-border);
    padding-bottom: calc(var(--grid-unit) * 4);
    color: var(--color-text-primary);
  }

  .post-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
  }

  .post-item a {
    color: var(--color-text-primary);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  a.post-item:hover,
  a.post-item:focus,
  a.post-item:hover h2,
  a.post-item:focus h2 {
    color: var(--color-accent);
  }

  .post-meta {
    display: flex;
    flex-direction: column;
    gap: calc(var(--grid-unit));
    margin-bottom: calc(var(--grid-unit) * 2);
  }

  .post-date {
    font-family: var(--font-mono);
    font-size: 0.9rem;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .post-tags {
    display: flex;
    flex-wrap: wrap;
    gap: calc(var(--grid-unit) / 2);
  }

  .tag {
    background-color: transparent;
    color: var(--color-accent);
    border: 1px solid var(--color-accent);
    padding: calc(var(--grid-unit) / 4) calc(var(--grid-unit) / 2);
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: 2px;
  }

  .no-posts {
    text-align: center;
    padding: calc(var(--grid-unit) * 6);
    color: var(--color-text-muted);
    font-style: italic;
  }

  .no-posts code {
    background-color: var(--color-surface);
    padding: 2px 4px;
    border-radius: 3px;
    font-family: var(--font-mono);
  }

  @media (max-width: 768px) {
    .project-title {
      font-size: 2.5rem;
    }

    .project-description {
      font-size: 1.125rem;
    }

    .post-title {
      font-size: 1.75rem;
    }

    .post-meta {
      flex-direction: column;
      align-items: flex-start;
    }
  }
</style>
